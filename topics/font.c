/*----------------------------------------*/
/*              FONT MODULE               */
/* Install the VNI font                   */
/*----------------------------------------*/

#include <dos.h>
#include <stdio.h>
#include <string.h>
#include <conio.h>

typedef unsigned char font[128][16];
const font code_font = {
    {0,0,108,56,0,120,12,124,204,204,204,118,0,0,0,0},                  // 128�
    {12,24,108,56,0,120,12,124,204,204,204,118,0,0,0,0},                // �
    {96,48,108,56,0,120,12,124,204,204,204,118,0,0,0,0},                // �
    {48,16,108,56,0,120,12,124,204,204,204,118,0,0,0,0},                // �
    {20,40,108,56,0,120,12,124,204,204,204,118,0,0,0,0},                // �
    {0,0,108,56,0,120,12,124,204,204,204,118,0,48,48,0},                // �
    {0,0,56,108,0,120,12,124,204,204,204,118,0,0,0,0},                  // �
    {6,12,56,108,0,120,12,124,204,204,204,118,0,0,0,0},                 // �
    {192,96,56,108,0,120,12,124,204,204,204,118,0,0,0,0},               // �
    {28,4,56,108,0,120,12,124,204,204,204,118,0,0,0,0},                 // �
    {54,108,56,108,0,120,12,124,204,204,204,118,0,0,0,0},               // 138�
    {0,0,56,108,0,120,12,124,204,204,204,118,0,48,48,0},                // �
    {0,0,56,108,0,124,198,254,192,192,198,124,0,0,0,0},                 // �
    {6,12,56,108,0,124,198,254,192,192,198,124,0,0,0,0},                // �
    {192,96,56,108,0,124,198,254,192,192,198,124,0,0,0,0},              // �
    {28,4,56,108,0,124,198,254,192,192,198,124,0,0,0,0},                // �
    {54,108,56,108,0,124,198,254,192,192,198,124,0,0,0,0},              // �
    {0,0,56,108,0,124,198,254,192,192,198,124,0,48,48,0},               // �
    {0,0,0,6,2,126,198,198,198,198,198,124,0,0,0,0},                    // �
    {0,12,24,6,2,126,198,198,198,198,198,124,0,0,0,0},                  // �
    {0,96,48,6,2,126,198,198,198,198,198,124,0,0,0,0},                  // 148�
    {0,56,8,22,2,126,198,198,198,198,198,124,0,0,0,0},                  // �
    {0,54,108,6,2,126,198,198,198,198,198,124,0,0,0,0},                 // �
    {0,0,0,6,2,126,198,198,198,198,198,124,0,48,48,0},                  // �
    {0,0,56,108,0,124,198,198,198,198,198,124,0,0,0,0},                 // �
    {6,12,56,108,0,124,198,198,198,198,198,124,0,0,0,0},                // �
    {192,96,56,108,0,124,198,198,198,198,198,124,0,0,0,0},              // �
    {14,2,60,108,0,124,198,198,198,198,198,124,0,0,0,0},                // �
    {54,108,56,108,0,124,198,198,198,198,198,124,0,0,0,0},              // �
    {0,0,56,108,0,124,198,198,198,198,198,124,0,48,48,0},               // �
    {0,0,0,6,2,206,204,204,204,204,204,118,0,0,0,0},                    // 158�
    {0,12,24,6,2,206,204,204,204,204,204,118,0,0,0,0},                  // �
    {0,96,48,6,2,206,204,204,204,204,204,118,0,0,0,0},                  // �
    {0,56,8,22,2,206,204,204,204,204,204,118,0,0,0,0},                  // �
    {0,54,108,6,2,206,204,204,204,204,204,118,0,0,0,0},                 // �
    {0,0,0,6,2,206,204,204,204,204,204,118,0,48,48,0},                  // �
    {0,0,12,24,0,120,12,124,204,204,204,118,0,0,0,0},                   // �
    {0,0,96,48,0,120,12,124,204,204,204,118,0,0,0,0},                   // �
    {0,56,8,16,0,120,12,124,204,204,204,118,0,0,0,0},                   // �
    {0,0,54,108,0,120,12,124,204,204,204,118,0,0,0,0},                  // �
    {0,0,0,0,0,120,12,124,204,204,204,118,0,48,48,0},                   //168�
    {0,0,12,24,0,124,198,254,192,192,198,124,0,0,0,0},                  // �
    {0,0,96,48,0,124,198,254,192,192,198,124,0,0,0,0},                  // �
    {0,56,8,16,0,124,198,254,192,192,198,124,0,0,0,0},                  // �
    {0,0,54,108,0,124,198,254,192,192,198,124,0,0,0,0},                 // �
    {0,0,0,0,0,124,198,254,192,192,198,124,0,48,48,0},                  // �
    {0,0,12,24,0,56,24,24,24,24,24,60,0,0,0,0},                         // �
    {0,0,48,24,0,56,24,24,24,24,24,60,0,0,0,0},                         // �
    {17,68,17,68,17,68,17,68,17,68,17,68,17,68,17,68},                  // �
    {85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170},          // �
    {221,119,221,119,221,119,221,119,221,119,221,119,221,119,221,119},  // 178�
    {192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192},  // �
    {3,3,3,3,3,3,3,255,255,3,3,3,3,3,3,3},                              // �
    {0,56,8,16,0,56,24,24,24,24,24,60,0,0,0,0},                         // �
    {0,0,54,108,0,56,24,24,24,24,24,60,0,0,0,0},                        // �
    {0,0,24,24,0,56,24,24,24,24,24,60,0,24,24,0},                       // �
    {0,0,12,24,0,124,198,198,198,198,198,124,0,0,0,0},                  // �
    {54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54},                 // �
    {54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54},                  // �
    {0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54},                      // �
    {54,54,54,54,54,246,6,254,0,0,0,0,0,0,0,0},                         // 188�
    {54,54,54,54,54,54,54,254,0,0,0,0,0,0,0,0},                         // �
    {0,0,96,48,0,124,198,198,198,198,198,124,0,0,0,0},                  // �
    {255,255,3,3,3,3,3,3,3,3,3,3,3,3,3,3},                              // �
    {192,192,192,192,192,192,192,192,192,192,192,192,192,192,255,255},  // �
    {255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0},                              // ��
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255},                              // �
    {192,192,192,192,192,192,192,255,255,192,192,192,192,192,192,192},  // �
    {0,0,0,0,0,0,0,255,255,0,0,0,0,0,0,0},                              // �
    {24,24,24,24,24,24,24,255,255,24,24,24,24,24,24,24},                // �
    {0,56,8,16,0,124,198,198,198,198,198,124,0,0,0,0}, 	                // 198�
    {0,0,54,108,0,124,198,198,198,198,198,124,0,0,0,0},                 // �
    {54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0},                          // �
    {0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54},                       // �
    {54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0},                         // �
    {0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54},                      // �
    {54,54,54,54,54,55,48,55,54,54,54,54,54,54,54,54},                  // �
    {0,0,0,0,0,255,0,255,0,0,0,0,0,0,0,0},                              // �
    {54,54,54,54,54,247,0,247,54,54,54,54,54,54,54,54},                 // �
    {24,24,24,24,24,255,0,255,0,0,0,0,0,0,0,0},                         // �
    {0,0,0,0,0,124,198,198,198,198,198,124,0,48,48,0},                  // 208�
    {0,0,0,0,0,255,0,255,24,24,24,24,24,24,24,24},                      // �
    {0,0,12,24,0,204,204,204,204,204,204,118,0,0,0,0},                  // �
    {0,0,96,48,0,204,204,204,204,204,204,118,0,0,0,0},                  // �
    {0,56,8,16,0,204,204,204,204,204,204,118,0,0,0,0},                  // �
    {0,0,108,216,0,204,204,204,204,204,204,118,0,0,0,0},                // �
    {0,0,0,0,0,204,204,204,204,204,204,118,0,48,48,0},                  // �
    {0,0,12,24,0,198,198,198,198,198,198,126,6,12,248,0},               // �
    {0,0,96,48,0,198,198,198,198,198,198,126,6,12,248,0},               // 216�
    {24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0},                         // �
    {255,255,192,192,192,192,192,192,192,192,192,192,192,192,192,192},  // �
    {255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255},  // �
    {0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255},                // �
    {0,0,56,8,16,198,198,198,198,198,198,126,6,12,248,0},               // �
    {0,0,54,108,0,198,198,198,198,198,198,126,6,12,248,0},              // �
    {255,255,255,255,255,255,255,0,0,0,0,0,0,0,0},                      // �
    {3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3},                                  // 224�
    {3,3,3,3,3,3,3,3,3,3,3,3,3,3,255,255},                              // �
    {128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128},  // �
    {0,0,255,128,128,128,128,128,128,128,128,128,255,63,0,0},           // �
    {0,0,254,2,3,51,67,67,51,3,3,3,255,255,0,0},                        // �
    {255,255,128,128,128,128,128,143,143,128,128,128,128,128,255,255},  // �
    {0,0,255,128,128,143,136,191,136,143,128,128,255,63,0,0},           // �
    {0,0,7,8,16,32,33,35,35,33,32,16,8,7,0,0},                          // �
    {0,0,224,16,8,4,132,196,196,132,4,8,16,224,0,0},                    // 232�
    {0,0,7,8,16,32,32,32,32,32,32,16,8,7,0,0},                          // �
    {0,0,224,16,8,4,4,4,4,4,4,8,16,224,0,0},                            // �
    {0,0,30,48,24,12,62,102,102,102,102,60,0,0,0,0},                    // �
    {0,0,0,0,0,126,219,219,219,126,0,0,0,0,0,0},                        // �
    {0,0,0,3,6,126,207,219,243,126,96,192,0,0,0,0},                     // �
    {0,0,28,48,96,96,124,96,96,96,48,28,0,0,0,0},                       // �
    {0,0,0,124,198,198,198,198,198,198,198,198,0,0,0,0},                // �
    {0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0},                            // 240�
    {0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0},                          // �
    {0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0},                          // �
    {0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0},                         // �
    {0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24},                    // �
    {24,24,24,24,24,24,24,24,216,216,216,112,0,0,0,0},                  // �
    {0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0},                            // �
    {0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0},                          // �
    {0,0,0,0,0,198,198,198,198,198,198,126,6,12,248,24},                // 248�
    {0,0,12,30,12,60,108,204,204,204,204,118,0,0,0,0},                  // �
    {0,0,248,108,102,102,246,102,102,102,108,248,0,0,0,0},              // �
    {0,1,1,1,2,2,2,4,4,132,200,104,56,16,0,0},                          // �
    {255,255,1,1,1,1,1,241,241,1,1,1,1,1,255,255},                      // �
    {0,0,254,2,3,227,35,251,35,227,3,3,255,255,0,0},                    // �
    {0,0,0,0,124,124,124,124,124,124,124,0,0,0,0,0},                    // �
    {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
};

void load_font()
{
    union REGPACK regs;
    regs.w.ax = 0x1100;
    regs.w.bx = 0x1000;
    regs.w.cx = 128;
    regs.w.dx = 128;
    regs.w.es = FP_SEG(code_font);
    regs.w.bp = FP_OFF(code_font);
    intr(0x10, &regs);
}

void unload_font()
{
    union REGS regs;
    regs.x.ax = 0x1104;
    regs.x.bx = 0;
    int86(0x10, &regs, &regs);
}

void set_char_width(unsigned char hwidth)
{
    union REGS regs;
    unsigned char x;
    regs.x.bx = (hwidth == 8) ? 0x0001 : 0x0800;
    x = inp(0x3CC) & (255 - 12);
    if (hwidth == 9) x |= 4;
    outp(0x3C2, x);
    _disable();
    outpw(0x3C4, 0x0100);
    outpw(0x3C4, 0x01 + (regs.h.bl << 8));
    outpw(0x3C4, 0x0300);
    _enable();
    regs.x.ax = 0x1000;
    regs.h.bl = 0x13;
    int86(0x10, &regs, &regs);
}

int main(int argc, char *argv[])
{
    if ((argc < 2) || (stricmp(argv[1], "ON") && stricmp(argv[1], "OFF")))
    {
        puts("FONT - Copyright (c) by Nguyen Ngoc Van 2000 - 2003. All rights reserved.");
        puts("Syntax : FONT [ON | OFF]");
        puts("\tON  : Load a new font.");
        puts("\tOFF : Unload a new font.");
        return 1;
    }

    if (!stricmp(argv[1],"ON"))
    {
        load_font();
        set_char_width(8);
    }
    else
    {
        unload_font();
        set_char_width(9);
    }

    return 0;
}
