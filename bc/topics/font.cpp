#include <dos.h>
#include <stdio.h>
#include <string.h>
#include <conio.h>

typedef unsigned char font[128][16];
const font code_font = {
  {0,0,108,56,0,120,12,124,204,204,204,118,0,0,0,0},						// 128Ä
  {12,24,108,56,0,120,12,124,204,204,204,118,0,0,0,0},					// Å
  {96,48,108,56,0,120,12,124,204,204,204,118,0,0,0,0},   				// Ç
  {48,16,108,56,0,120,12,124,204,204,204,118,0,0,0,0},    				// É
  {20,40,108,56,0,120,12,124,204,204,204,118,0,0,0,0},    				// Ñ
  {0,0,108,56,0,120,12,124,204,204,204,118,0,48,48,0},    				// Ö
  {0,0,56,108,0,120,12,124,204,204,204,118,0,0,0,0},     				// Ü
  {6,12,56,108,0,120,12,124,204,204,204,118,0,0,0,0},     				// á
  {192,96,56,108,0,120,12,124,204,204,204,118,0,0,0,0},   				// à
  {28,4,56,108,0,120,12,124,204,204,204,118,0,0,0,0},      				// â
  {54,108,56,108,0,120,12,124,204,204,204,118,0,0,0,0}, 					// 138ä
  {0,0,56,108,0,120,12,124,204,204,204,118,0,48,48,0},    				// ã
  {0,0,56,108,0,124,198,254,192,192,198,124,0,0,0,0},     				// å
  {6,12,56,108,0,124,198,254,192,192,198,124,0,0,0,0},    				// ç
  {192,96,56,108,0,124,198,254,192,192,198,124,0,0,0,0},  				// é
  {28,4,56,108,0,124,198,254,192,192,198,124,0,0,0,0},     				// è
  {54,108,56,108,0,124,198,254,192,192,198,124,0,0,0,0},  				// ê
  {0,0,56,108,0,124,198,254,192,192,198,124,0,48,48,0},   				// ë
  {0,0,0,6,2,126,198,198,198,198,198,124,0,0,0,0},       				// í
  {0,12,24,6,2,126,198,198,198,198,198,124,0,0,0,0},   					// ì
  {0,96,48,6,2,126,198,198,198,198,198,124,0,0,0,0}, 						// 148î
  {0,56,8,22,2,126,198,198,198,198,198,124,0,0,0,0},    					// ï
  {0,54,108,6,2,126,198,198,198,198,198,124,0,0,0,0},     				// ñ
  {0,0,0,6,2,126,198,198,198,198,198,124,0,48,48,0},      				// ó
  {0,0,56,108,0,124,198,198,198,198,198,124,0,0,0,0},    				// ò
  {6,12,56,108,0,124,198,198,198,198,198,124,0,0,0,0},   				// ô
  {192,96,56,108,0,124,198,198,198,198,198,124,0,0,0,0}, 				// ö
  {14,2,60,108,0,124,198,198,198,198,198,124,0,0,0,0},   				// õ
  {54,108,56,108,0,124,198,198,198,198,198,124,0,0,0,0},  				// ú
  {0,0,56,108,0,124,198,198,198,198,198,124,0,48,48,0},  				// ù
  {0,0,0,6,2,206,204,204,204,204,204,118,0,0,0,0}, 						// 158û
  {0,12,24,6,2,206,204,204,204,204,204,118,0,0,0,0},     				// ü
  {0,96,48,6,2,206,204,204,204,204,204,118,0,0,0,0},     				// †
  {0,56,8,22,2,206,204,204,204,204,204,118,0,0,0,0},    					// °
  {0,54,108,6,2,206,204,204,204,204,204,118,0,0,0,0},    				// ¢
  {0,0,0,6,2,206,204,204,204,204,204,118,0,48,48,0},     				// £
  {0,0,12,24,0,120,12,124,204,204,204,118,0,0,0,0},      				// §
  {0,0,96,48,0,120,12,124,204,204,204,118,0,0,0,0},       				// •
  {0,56,8,16,0,120,12,124,204,204,204,118,0,0,0,0},       				// ¶
  {0,0,54,108,0,120,12,124,204,204,204,118,0,0,0,0},     				// ß
  {0,0,0,0,0,120,12,124,204,204,204,118,0,48,48,0}, 						//168®
  {0,0,12,24,0,124,198,254,192,192,198,124,0,0,0,0},     				// ©
  {0,0,96,48,0,124,198,254,192,192,198,124,0,0,0,0},     				// ™
  {0,56,8,16,0,124,198,254,192,192,198,124,0,0,0,0},     				// ´
  {0,0,54,108,0,124,198,254,192,192,198,124,0,0,0,0},    				// ¨
  {0,0,0,0,0,124,198,254,192,192,198,124,0,48,48,0},     				// ≠
  {0,0,12,24,0,56,24,24,24,24,24,60,0,0,0,0},            				// Æ
  {0,0,48,24,0,56,24,24,24,24,24,60,0,0,0,0},            				// Ø
  {17,68,17,68,17,68,17,68,17,68,17,68,17,68,17,68},     				// ∞
  {85,170,85,170,85,170,85,170,85,170,85,170,85,170,85,170},			// ±
  {221,119,221,119,221,119,221,119,221,119,221,119,221,119,221,119}, // 178≤
  {192,192,192,192,192,192,192,192,192,192,192,192,192,192,192,192}, // ≥
  {3,3,3,3,3,3,3,255,255,3,3,3,3,3,3,3},                             // ¥
  {0,56,8,16,0,56,24,24,24,24,24,60,0,0,0,0},                       	// µ
  {0,0,54,108,0,56,24,24,24,24,24,60,0,0,0,0},                     	// ∂
  {0,0,24,24,0,56,24,24,24,24,24,60,0,24,24,0},                    	// ∑
  {0,0,12,24,0,124,198,198,198,198,198,124,0,0,0,0},               	// ∏
  {54,54,54,54,54,246,6,246,54,54,54,54,54,54,54,54},              	// π
  {54,54,54,54,54,54,54,54,54,54,54,54,54,54,54,54},               	// ∫
  {0,0,0,0,0,254,6,246,54,54,54,54,54,54,54,54},                   	// ª
  {54,54,54,54,54,246,6,254,0,0,0,0,0,0,0,0}, 								// 188º
  {54,54,54,54,54,54,54,254,0,0,0,0,0,0,0,0},                      	// Ω
  {0,0,96,48,0,124,198,198,198,198,198,124,0,0,0,0},               	// æ
  {255,255,3,3,3,3,3,3,3,3,3,3,3,3,3,3},                             // ø
  {192,192,192,192,192,192,192,192,192,192,192,192,192,192,255,255},	// ¿
  {255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0},                          	// ¡¡
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255},                             // ¬
  {192,192,192,192,192,192,192,255,255,192,192,192,192,192,192,192},	// √
  {0,0,0,0,0,0,0,255,255,0,0,0,0,0,0,0},                             // ƒ
  {24,24,24,24,24,24,24,255,255,24,24,24,24,24,24,24},               // ≈
  {0,56,8,16,0,124,198,198,198,198,198,124,0,0,0,0}, 						// 198∆
  {0,0,54,108,0,124,198,198,198,198,198,124,0,0,0,0},              	// «
  {54,54,54,54,54,55,48,63,0,0,0,0,0,0,0,0},                       	// »
  {0,0,0,0,0,63,48,55,54,54,54,54,54,54,54,54},                    	// …
  {54,54,54,54,54,247,0,255,0,0,0,0,0,0,0,0},                      	//  
  {0,0,0,0,0,255,0,247,54,54,54,54,54,54,54,54},                   	// À
  {54,54,54,54,54,55,48,55,54,54,54,54,54,54,54,54},               	// Ã
  {0,0,0,0,0,255,0,255,0,0,0,0,0,0,0,0},                           	// Õ
  {54,54,54,54,54,247,0,247,54,54,54,54,54,54,54,54},              	// Œ
  {24,24,24,24,24,255,0,255,0,0,0,0,0,0,0,0},                       	// œ
  {0,0,0,0,0,124,198,198,198,198,198,124,0,48,48,0}, 						// 208–
  {0,0,0,0,0,255,0,255,24,24,24,24,24,24,24,24},                    	// —
  {0,0,12,24,0,204,204,204,204,204,204,118,0,0,0,0},                 // “
  {0,0,96,48,0,204,204,204,204,204,204,118,0,0,0,0},              	// ”
  {0,56,8,16,0,204,204,204,204,204,204,118,0,0,0,0},              	// ‘
  {0,0,108,216,0,204,204,204,204,204,204,118,0,0,0,0},            	// ’
  {0,0,0,0,0,204,204,204,204,204,204,118,0,48,48,0},              	// ÷
  {0,0,12,24,0,198,198,198,198,198,198,126,6,12,248,0},           	// ◊
  {0,0,96,48,0,198,198,198,198,198,198,126,6,12,248,0}, 					// 216ÿ
  {24,24,24,24,24,24,24,248,0,0,0,0,0,0,0,0},                      	// Ÿ
  {255,255,192,192,192,192,192,192,192,192,192,192,192,192,192,192},	// ⁄
  {255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255},	// €
  {0,0,0,0,0,0,0,255,255,255,255,255,255,255,255,255},             	// ‹
  {0,0,56,8,16,198,198,198,198,198,198,126,6,12,248,0},            	// ›
  {0,0,54,108,0,198,198,198,198,198,198,126,6,12,248,0},           	// ﬁ
  {255,255,255,255,255,255,255,0,0,0,0,0,0,0,0},                    	// ﬂ
  {3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3}, 											// 224‡
  {3,3,3,3,3,3,3,3,3,3,3,3,3,3,255,255},                         		// ·
  {128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128},	// ‚
  {0,0,255,128,128,128,128,128,128,128,128,128,255,63,0,0},         	// „
  {0,0,254,2,3,51,67,67,51,3,3,3,255,255,0,0},                      	// ‰
  {255,255,128,128,128,128,128,143,143,128,128,128,128,128,255,255},	// Â
  {0,0,255,128,128,143,136,191,136,143,128,128,255,63,0,0},        	// Ê
  {0,0,7,8,16,32,33,35,35,33,32,16,8,7,0,0},                       	// Á
  {0,0,224,16,8,4,132,196,196,132,4,8,16,224,0,0}, 						// 232Ë
  {0,0,7,8,16,32,32,32,32,32,32,16,8,7,0,0},                        	// È
  {0,0,224,16,8,4,4,4,4,4,4,8,16,224,0,0},                          	// Í
  {0,0,30,48,24,12,62,102,102,102,102,60,0,0,0,0},                  	// Î
  {0,0,0,0,0,126,219,219,219,126,0,0,0,0,0,0},                      	// Ï
  {0,0,0,3,6,126,207,219,243,126,96,192,0,0,0,0},                  	// Ì
  {0,0,28,48,96,96,124,96,96,96,48,28,0,0,0,0},                     	// Ó
  {0,0,0,124,198,198,198,198,198,198,198,198,0,0,0,0},              	// Ô
  {0,0,0,0,254,0,0,254,0,0,254,0,0,0,0,0}, 									// 240
  {0,0,0,0,24,24,126,24,24,0,0,255,0,0,0,0},                        	// Ò
  {0,0,0,48,24,12,6,12,24,48,0,126,0,0,0,0},                        	// Ú
  {0,0,0,12,24,48,96,48,24,12,0,126,0,0,0,0},                       	// Û
  {0,0,14,27,27,24,24,24,24,24,24,24,24,24,24,24},                  	// Ù
  {24,24,24,24,24,24,24,24,216,216,216,112,0,0,0,0},                	// ı
  {0,0,0,0,24,24,0,126,0,24,24,0,0,0,0,0},                          	// ˆ
  {0,0,0,0,0,118,220,0,118,220,0,0,0,0,0,0},                        	// ˜
  {0,0,0,0,0,198,198,198,198,198,198,126,6,12,248,24}, 					// 248¯
  {0,0,12,30,12,60,108,204,204,204,204,118,0,0,0,0},                	// ˘
  {0,0,248,108,102,102,246,102,102,102,108,248,0,0,0,0},            	// ˙
  {0,1,1,1,2,2,2,4,4,132,200,104,56,16,0,0},                        	// ˚
  {255,255,1,1,1,1,1,241,241,1,1,1,1,1,255,255},                    	// ¸
  {0,0,254,2,3,227,35,251,35,227,3,3,255,255,0,0},                  	// ˝
  {0,0,0,0,124,124,124,124,124,124,124,0,0,0,0,0},                 	// ˛
  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
};

void load_font()
{
	struct REGPACK regs;
	regs.r_ax = 0x1100;
	regs.r_bx = 0x1000;
	regs.r_cx = 128;
	regs.r_dx = 128;
	regs.r_es = FP_SEG(code_font);
	regs.r_bp = FP_OFF(code_font);
	intr(0x10, &regs);
}

void unload_font()
{
	union REGS regs;
	regs.x.ax = 0x1104;
	regs.x.bx = 0;
	int86(0x10, &regs, &regs);
}

void set_char_width(unsigned char hwidth)
{
	union REGS regs;
	unsigned char x;
	regs.x.bx = (hwidth == 8) ? 0x0001 : 0x0800;
	x = inp(0x3CC) & (255 - 12);
	if(hwidth == 9) x |= 4; outp(0x3C2, x);
	_disable();
	outpw(0x3C4,0x0100);
	outpw(0x3C4,0x01 + (regs.h.bl << 8));
	outpw(0x3C4,0x0300);
	_enable();
	regs.x.ax = 0x1000;
	regs.h.bl = 0x13;
	int86(0x10, &regs, &regs);
}

int main(int argc, char *argv[])
{
	if((argc < 2) || (stricmp(argv[1],"ON") && stricmp(argv[1],"OFF"))) {
		puts("FONT - Copyright (c) by Nguyen Ngoc Van 2000 - 2003. All rights reserved.");
		puts("Syntax : FONT [ON | OFF]");
		puts("\tON  : Loading a new font.");
		puts("\tOFF : Release a new font.");
		return 1;
	}
	if(!stricmp(argv[1],"ON")) {
		load_font(); set_char_width(8);
	}
	else {
		unload_font(); set_char_width(9);
	}
	return 0;
}